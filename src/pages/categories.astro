---
import Layout from '@/layouts/Layout.astro';
import CategoriesList from '@/components/categories/CategoriesList';
import { Toaster } from '@/components/ui/sonner';
import type { CategoryListItemDTO } from '@/types';
import { CategoryService } from '@/lib/services/category.service';


// Authentication check
const supabase = Astro.locals.supabase;
const { data: { user }, error: authError } = await supabase.auth.getUser();

if (authError || !user) {
  return Astro.redirect('/');
}


// Direct service call - no HTTP overhead
let initialCategories: CategoryListItemDTO[] = [];
try {
  initialCategories = await CategoryService.listCategories(
    supabase,
    user.id,
    'name',
    'asc'
  );
} catch (error) {
  console.error('Failed to fetch categories:', error);
}
---

<Layout title="Categories">
  <CategoriesList client:load initialCategories={initialCategories} />
  <Toaster client:load />
</Layout>
